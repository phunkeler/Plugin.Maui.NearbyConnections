<?xml version="1.0" encoding="utf-8" ?>
<pages:BasePage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                x:Class="NearbyChat.Pages.ChatPage"
                xmlns:pages="clr-namespace:NearbyChat.Pages"
                xmlns:vm="clr-namespace:NearbyChat.ViewModels"
                xmlns:idk="clr-namespace:Indiko.Maui.Controls.Chat;assembly=Indiko.Maui.Controls.Chat"
                xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                x:TypeArguments="vm:ChatPageViewModel"
                x:DataType="vm:ChatPageViewModel"
                Title="Chat">

    <pages:BasePage.Behaviors>
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference login}, x:DataType=pages:BasePage}"
            EventName="Appearing"
            Command="{Binding AppearingCommand}"/>
    </pages:BasePage.Behaviors>

    <Grid RowDefinitions="Auto,*,Auto,Auto">
        <!-- Header - Connection Status -->
        <Border Grid.Row="0"
                BackgroundColor="Blue"
                Padding="15,10">
            <Grid ColumnDefinitions="*,Auto">
                <Label x:Name="ConnectionStatusLabel"
                       Grid.Column="0"
                       Text="{Binding ConnectionStatus}"
                       TextColor="White"
                       FontSize="16"
                       VerticalOptions="Center"/>

                <Label x:Name="ConnectionIndicator"
                       Grid.Column="1"
                       Text="●"
                       TextColor="{Binding IsConnected, Converter={StaticResource BoolToConnectionColorConverter}}"
                       FontSize="18"
                       VerticalOptions="Center"/>
            </Grid>
        </Border>

        <!-- Messages Area -->
        <!--
        <idk:ChatView Grid.Row="1"
                      x:Name="chatView"
                      OwnMessageBackgroundColor="{StaticResource Primary}"
                      OwnMessageTextColor="{StaticResource White}"
                      OtherMessageBackgroundColor="{StaticResource Secondary}"
                      OtherMessageTextColor="{StaticResource Black}"
                      DateTextColor="{StaticResource Gray500}"
                      DateTextFontSize="14"
                      MessageTimeTextColor="{StaticResource Gray200}"
                      NewMessagesSeperatorTextColor="{StaticResource Primary}"
                      NewMessagesSeperatorFontSize="16"
                      NewMessagesSeperatorText="New Messages"
                      AvatarTextColor="{StaticResource White}"
                      AvatarBackgroundColor="{StaticResource Tertiary}"
                      Messages="{Binding ChatMessages}"
                      EmojiReactionFontSize="14"
                      EmojiReactionTextColor="{StaticResource Primary}"
                      ReplyMessageBackgroundColor="{StaticResource Tertiary}"
                      ReplyMessageTextColor="{StaticResource White}"
                      ScrollToFirstNewMessage="True"
                      ShowNewMessagesSeperator="True"
                      SystemMessageBackgroundColor="{StaticResource Yellow300Accent}"
                      SystemMessageTextColor="{StaticResource Tertiary}"
                      SystemMessageFontSize="14"
                      ContextMenuDividerColor="{StaticResource Gray300}"
                      ContextMenuTextColor="{StaticResource Gray600}"
                      ContextMenuBackgroundColor="{StaticResource White}"/>
        -->
        <!-- Message Input -->
        <Border Grid.Row="2"
                Padding="10"
                Margin="10,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Entry x:Name="UsernameEntry"
                       Style="{StaticResource TextInput}"
                       Text="{Binding CurrentMessage}"
                       Placeholder="Type a message..."
                       ReturnCommand="{Binding SendMessageCommand}"/>

                <Button x:Name="SendButton"
                        Grid.Column="1"
                        Text="Send"
                        TextColor="White"
                        Command="{Binding SendMessageCommand}"
                        IsEnabled="{Binding IsConnected}"/>
            </Grid>
        </Border>

        <!-- Connection Controls -->
        <Grid Grid.Row="3"
              Padding="10"
              ColumnDefinitions="*,*"
              ColumnSpacing="10">

            <Button x:Name="AdvertiseButton"
                    Text="Advertise"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding StartAdvertisingCommand}"/>

            <Button x:Name="DiscoverButton"
                    Grid.Column="1"
                    Text="Discover"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding StartDiscoveryCommand}"/>
        </Grid>
    </Grid>

</pages:BasePage>