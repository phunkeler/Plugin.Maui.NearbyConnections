<?xml version="1.0" encoding="utf-8" ?>
<pages:BasePage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                x:Class="NearbyChat.Pages.ChatPage"
                xmlns:pages="clr-namespace:NearbyChat.Pages"
                xmlns:vm="clr-namespace:NearbyChat.ViewModels"
                xmlns:mct="clr-namespace:CommunityToolkit.Maui.Core;assembly=CommunityToolkit.Maui.Core"
                xmlns:idk="clr-namespace:Indiko.Maui.Controls.Chat;assembly=Indiko.Maui.Controls.Chat"
                xmlns:sfBottomSheet="clr-namespace:Syncfusion.Maui.Toolkit.BottomSheet;assembly=Syncfusion.Maui.Toolkit"
                xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                x:TypeArguments="vm:ChatPageViewModel"
                x:DataType="vm:ChatPageViewModel"
                x:Name="chat">

    <pages:BasePage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter"/>
        </ResourceDictionary>
    </pages:BasePage.Resources>

    <pages:BasePage.Behaviors>
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference chat}, x:DataType=pages:BasePage}"
            EventName="Appearing"
            Command="{Binding AppearingCommand}"/>
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference chat}, x:DataType=pages:BasePage}"
            EventName="Disappearing"
            Command="{Binding DisappearingCommand}"/>
    </pages:BasePage.Behaviors>

    <Grid>

        <!-- Messages Area -->
        <idk:ChatView Grid.Row="0"
                      x:Name="chatView"
                      OwnMessageBackgroundColor="Blue"
                      OwnMessageTextColor="White"
                      OtherMessageBackgroundColor="Green"
                      OtherMessageTextColor="White"
                      DateTextColor="{StaticResource Gray500}"
                      Messages="{Binding ChatMessages}"
                      DateTextFontSize="14"
                      MessageTimeTextColor="{StaticResource Gray200}"
                      NewMessagesSeperatorTextColor="{StaticResource Gray300}"
                      NewMessagesSeperatorFontSize="16"
                      NewMessagesSeperatorText="New Messages"
                      EmojiReactionFontSize="14"
                      EmojiReactionTextColor="Green"
                      ReplyMessageBackgroundColor="Blue"
                      ReplyMessageTextColor="White"
                      ShowNewMessagesSeperator="True"
                      SystemMessageBackgroundColor="{DynamicResource Gray400}"
                      SystemMessageTextColor="Black"
                      SystemMessageFontSize="14"
                      ContextMenuDividerColor="{StaticResource Gray300}"
                      ContextMenuTextColor="{StaticResource Gray200}"
                      ContextMenuBackgroundColor="{StaticResource Gray700}"/>

        <!-- Message Input -->
        <Border Grid.Row="1"
                VerticalOptions="End"
                Padding="10"
                Margin="10,5">
            <Grid ColumnSpacing="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Entry x:Name="UsernameEntry"
                       Style="{StaticResource TextInput}"
                       Text="{Binding CurrentMessage}"
                       Placeholder="Type a message..."
                       ReturnCommand="{Binding SendMessageCommand}"/>

                <Button x:Name="SendButton"
                        Grid.Column="1"
                        Text="Send"
                        BackgroundColor="Blue"
                        TextColor="Black"
                        Command="{Binding SendMessageCommand}"/>

                <Button x:Name="SettingsButton"
                        WidthRequest="48"
                        HeightRequest="48"
                        Grid.Column="2"
                        Text="&#xe001;"
                        CornerRadius="24"
                        FontFamily="NearbyChatIcons"
                        FontSize="24"
                        BackgroundColor="{DynamicResource Primary}"
                        TextColor="White"
                        Clicked="OnSettingsButtonClicked"/>
            </Grid>
        </Border>
        <sfBottomSheet:SfBottomSheet x:Name="bottomSheet"
                                     Grid.Row="1"
                                     CornerRadius="25, 25, 0, 0"
                                     HalfExpandedRatio="0.25"
                                     ContentPadding="10">
            <sfBottomSheet:SfBottomSheet.BottomSheetContent>
                <VerticalStackLayout Spacing="5"
                                     BackgroundColor="{DynamicResource Gray800}"
                                     x:Name="bottomSheetContent">

                    <Button Text="Advertise"
                            Command="{Binding StartAdvertisingCommand}"
                            IsEnabled="{Binding IsAdvertising, Converter={StaticResource InvertedBoolConverter}}"/>

                    <Button Text="Discover"
                            Command="{Binding StartDiscoveryCommand}"
                            IsEnabled="{Binding IsDiscovering, Converter={StaticResource InvertedBoolConverter}}"/>

                </VerticalStackLayout>
            </sfBottomSheet:SfBottomSheet.BottomSheetContent>
        </sfBottomSheet:SfBottomSheet>
    </Grid>

</pages:BasePage>