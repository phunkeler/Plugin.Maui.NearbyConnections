<?xml version="1.0" encoding="utf-8" ?>
<pages:BasePage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                x:Class="NearbyChat.Pages.ChatPage"
                xmlns:pages="clr-namespace:NearbyChat.Pages"
                xmlns:vm="clr-namespace:NearbyChat.ViewModels"
                xmlns:mct="clr-namespace:CommunityToolkit.Maui.Core;assembly=CommunityToolkit.Maui.Core"
                xmlns:sfBottomSheet="clr-namespace:Syncfusion.Maui.Toolkit.BottomSheet;assembly=Syncfusion.Maui.Toolkit"
                xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                x:TypeArguments="vm:ChatPageViewModel"
                x:DataType="vm:ChatPageViewModel"
                x:Name="chat">

    <pages:BasePage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter"/>
        </ResourceDictionary>
    </pages:BasePage.Resources>

    <pages:BasePage.Behaviors>
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference chat}, x:DataType=pages:ChatPage}"
            EventName="Appearing"
            Command="{Binding AppearingCommand}"/>
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference chat}, x:DataType=pages:ChatPage}"
            EventName="Disappearing"
            Command="{Binding DisappearingCommand}"/>
    </pages:BasePage.Behaviors>

    <pages:BasePage.Content>
        <Grid>
            <!-- Message Input -->
            <Border Grid.Row="1"
                    VerticalOptions="End"
                    Padding="10"
                    Margin="10,5">
                <Grid ColumnSpacing="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Label Text="WHY"/>

                    <Button x:Name="SendButton"
                            Grid.Column="1"
                            WidthRequest="48"
                            HeightRequest="48"
                            CornerRadius="24"
                            ImageSource="{FontImageSource Glyph=&#xe002;, Color={AppThemeBinding Light=White, Dark=White}, FontFamily=NearbyChatIcons, Size=36}"
                            BackgroundColor="{DynamicResource PrimaryBlue700}"
                            Command="{Binding SendMessageCommand}"/>

                    <Button x:Name="SettingsButton"
                            Grid.Column="2"
                            WidthRequest="48"
                            HeightRequest="48"
                            CornerRadius="24"
                            ImageSource="{FontImageSource Glyph=&#xe001;, Color={AppThemeBinding Light=White, Dark=White}, FontFamily=NearbyChatIcons, Size=36}"
                            BackgroundColor="{DynamicResource PrimaryBlue700}"
                            Clicked="OnSettingsButtonClicked"/>
                </Grid>
            </Border>
            <sfBottomSheet:SfBottomSheet x:Name="bottomSheet"
                                         Grid.Row="1"
                                         CornerRadius="25, 25, 0, 0"
                                         HalfExpandedRatio="0.5"
                                         ContentPadding="10">
                <sfBottomSheet:SfBottomSheet.BottomSheetContent>
                    <VerticalStackLayout Spacing="5"
                                         x:Name="bottomSheetContent">

                        <Label Text="Advertising"
                               FontSize="18"
                               TextColor="{DynamicResource Gray800}"/>
                        <Switch x:Name="advertisingSwitch">
                            <Switch.Behaviors>
                                <toolkit:EventToCommandBehavior
                                    BindingContext="{Binding Path=BindingContext, Source={x:Reference advertisingSwitch}, x:DataType=Switch}"
                                    x:TypeArguments="ToggledEventArgs"
                                    EventName="Toggled"
                                    Command="{Binding AdvertiseCommand}"/>
                            </Switch.Behaviors>
                        </Switch>

                        <Label Text="Discovering"
                               FontSize="18"
                               TextColor="{DynamicResource Gray800}"/>
                        <Switch x:Name="discoverySwitch">
                            <Switch.Behaviors>
                                <toolkit:EventToCommandBehavior
                                    BindingContext="{Binding Path=BindingContext, Source={x:Reference discoverySwitch}, x:DataType=Switch}"
                                    x:TypeArguments="ToggledEventArgs"
                                    EventName="Toggled"
                                    Command="{Binding DiscoverCommand}"/>
                            </Switch.Behaviors>
                        </Switch>
                    </VerticalStackLayout>
                </sfBottomSheet:SfBottomSheet.BottomSheetContent>
            </sfBottomSheet:SfBottomSheet>
        </Grid>
    </pages:BasePage.Content>
</pages:BasePage>