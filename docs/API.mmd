classDiagram
    %% Main Entry Points
    class NearbyConnections {
        <<static>>
        +Configure(Action~NearbyConnectionsOptions~) void
        +Default INearbyConnections
    }

    %% Core Interface
    class INearbyConnections {
        <<interface>>
        +Events IObservable~INearbyConnectionsEvent~
        +IsAdvertising bool
        +IsDiscovering bool
        +Devices IReadOnlyDictionary~string, INearbyDevice~
        +DefaultOptions NearbyConnectionsOptions
        +StartAdvertisingAsync(AdvertiseOptions?, CancellationToken) Task
        +StartDiscoveryAsync(DiscoverOptions?, CancellationToken) Task
        +StopAdvertisingAsync() Task
        +StopDiscoveryAsync() Task
        +SendInvitation(INearbyDevice, CancellationToken) Task
        +Dispose() void
    }

    %% Configuration
    class NearbyConnectionsOptions {
        +AdvertiserOptions AdvertiseOptions
        +DiscovererOptions DiscoverOptions
        +EventPublisher EventPublisherOptions
        +AutoAcceptConnections bool
        +DiscoveryTimeoutSeconds int
        +AdvertisingTimeoutSeconds int
    }

    class AdvertiseOptions {
        +DisplayName string
        +ServiceName string
        +AdvertisingInfo IDictionary~string, string~
    }

    class DiscoverOptions {
        +ServiceName string
    }

    class EventPublisherOptions {
        +EnableCorrelation bool
        +EnableDeduplication bool
        +DeduplicationWindowMs int
        +MaxBufferSize int
        +AddEventProcessor(Func~IServiceProvider, IEventProcessor~) EventPublisherOptions
        +AddEventProcessor~TProcessor~() EventPublisherOptions
        +AddEventProcessor(IEventProcessor) EventPublisherOptions
    }

    %% Device Model
    class INearbyDevice {
        <<interface>>
        +Id string
        +DisplayName string
        +Status NearbyDeviceStatus
    }

    class NearbyDeviceStatus {
        <<enumeration>>
        Disconnected
        Discovered
        Invited
        Connected
    }

    %% Events
    class INearbyConnectionsEvent {
        <<interface>>
        +EventId string
        +Timestamp DateTimeOffset
    }

    class NearbyDeviceFound {
        +EventId string
        +Timestamp DateTimeOffset
        +Device INearbyDevice
    }

    class NearbyDeviceLost {
        +EventId string
        +Timestamp DateTimeOffset
        +Device INearbyDevice
    }

    class InvitationReceived {
        +EventId string
        +Timestamp DateTimeOffset
        +From INearbyDevice
    }

    class InvitationAnswered {
        +EventId string
        +Timestamp DateTimeOffset
        +From INearbyDevice
    }

    class NearbyDeviceDisconnected {
        +EventId string
        +Timestamp DateTimeOffset
        +Device INearbyDevice
    }

    %% Relationships
    NearbyConnections --> INearbyConnections : provides
    INearbyConnections --> NearbyConnectionsOptions : configured by
    INearbyConnections --> INearbyDevice : manages
    INearbyConnections --> INearbyConnectionsEvent : emits

    NearbyConnectionsOptions *-- AdvertiseOptions
    NearbyConnectionsOptions *-- DiscoverOptions
    NearbyConnectionsOptions *-- EventPublisherOptions

    INearbyDevice --> NearbyDeviceStatus : has

    INearbyConnectionsEvent <|.. NearbyDeviceFound : implements
    INearbyConnectionsEvent <|.. NearbyDeviceLost : implements
    INearbyConnectionsEvent <|.. InvitationReceived : implements
    INearbyConnectionsEvent <|.. InvitationAnswered : implements
    INearbyConnectionsEvent <|.. NearbyDeviceDisconnected : implements

    NearbyDeviceFound --> INearbyDevice : contains
    NearbyDeviceLost --> INearbyDevice : contains
    InvitationReceived --> INearbyDevice : from
    InvitationAnswered --> INearbyDevice : from
    NearbyDeviceDisconnected --> INearbyDevice : contains
